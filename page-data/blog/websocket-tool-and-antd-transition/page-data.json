{"componentChunkName":"component---src-templates-blog-detail-js","path":"/blog/websocket-tool-and-antd-transition","result":{"data":{"mdx":{"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"slug\": \"/blog/websocket-tool-and-antd-transition\",\n  \"title\": \"websocket封装&antd组件过渡动画应用\",\n  \"date\": \"2022-12-13 19:35:02\",\n  \"brief\": \"公司的绩效考核中每个季度都要进行技术分享了，是时候从攒下的知识库存里抽出一点内容来了。第一部分websocket相关的原生API非常简单，功能也非常基础，在项目中实际使用时可以进行简单地封装，添加断线重连的机制，以便于复用。第二部分是为了符合UI设计图自己定制的下拉组件。\",\n  \"tag\": \"react,antd\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h2\", null, \"WebSocket \\u5DE5\\u5177\\u7C7B\\u5C01\\u88C5\"), mdx(\"p\", null, \"\\u8FD9\\u91CC\\u5BF9 websocket \\u5E38\\u7528\\u7684API\\u8FDB\\u884C\\u8FDB\\u4E00\\u6B65\\u7684\\u5C01\\u88C5\\u3002\"), mdx(\"h3\", null, \"\\u5DE5\\u5177\\u7C7B\"), mdx(\"p\", null, \" \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"InstantWS.ts\"), \" \\u5982\\u4E0B\\uFF1A\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"export type Options = {\\n  /**\\n   * Websocket\\u5B9E\\u4F8B\\u540D\\u79F0\\n   */\\n  name: string;\\n  /**\\n   * \\u6700\\u5927\\u91CD\\u8FDE\\u6B21\\u6570\\n   * @default 10\\n   */\\n  reconnectMaxCount: number;\\n  /**\\n   * \\u91CD\\u8FDE\\u65F6\\u95F4\\u95F4\\u9694\\n   * @default 1000\\n   */\\n  reconnectTimeInterval: number;\\n  /**\\n   * \\u662F\\u5426\\u5F00\\u542F\\u63A7\\u5236\\u53F0\\u4FE1\\u606F\\u6253\\u5370\\n   * @default true\\n   */\\n  debugging: boolean;\\n};\\n\\n/**\\n * websocket \\u5C01\\u88C5\\n * \\u529F\\u80FD\\uFF1A\\n * 1. \\u8FDE\\u63A5\\u5931\\u8D25\\u4F1A\\u81EA\\u52A8\\u91CD\\u8FDE\\uFF0C\\u8D85\\u8FC7\\u8BBE\\u7F6E\\u7684\\u6700\\u5927\\u91CD\\u8FDE\\u6B21\\u6570\\u5219\\u4E0D\\u518D\\u8FDE\\u63A5\\n * 2. \\u7528\\u6237\\u6389\\u7EBF\\uFF08\\u975E\\u7528\\u6237\\u4E3B\\u52A8\\u65AD\\u5F00\\u8FDE\\u63A5\\uFF09\\u5219\\u81EA\\u52A8\\u91CD\\u8FDE\\n */\\nexport default class InstantWS {\\n  /**\\n   * Websocket\\u5B9E\\u4F8B\\n   */\\n  ws?: WebSocket;\\n\\n  /**\\n   * Websocket\\u5B9E\\u4F8B\\u540D\\u79F0\\n   */\\n  name?: string;\\n\\n  /**\\n   * \\u4E3B\\u52A8\\u65AD\\u5F00\\u8FDE\\u63A5\\u7684\\u6807\\u8BC6\\n   */\\n  protected disconnectFlag: boolean;\\n\\n  /**\\n   * \\u9ED8\\u8BA4\\u6700\\u5927\\u91CD\\u8FDE\\u6B21\\u6570\\n   */\\n  protected RECONNECT_MAX_COUNT: number;\\n\\n  /**\\n   * \\u9ED8\\u8BA4\\u91CD\\u8FDE\\u65F6\\u95F4\\u95F4\\u9694\\uFF08\\u5355\\u4F4D\\uFF1Ams\\uFF09\\n   */\\n  protected RECONNECT_TIME_INTERVAL: number;\\n\\n  /**\\n   * \\u5931\\u8D25\\u91CD\\u8FDE\\u8BA1\\u6570\\n   */\\n  protected reconnectCount: number;\\n\\n  /**\\n   * \\u5931\\u8D25\\u91CD\\u8FDE\\u5B9A\\u65F6\\u5668\\n   */\\n  protected reconnectTimer?: NodeJS.Timeout;\\n\\n  /**\\n   * \\u662F\\u5426\\u5728\\u63A7\\u5236\\u53F0\\u6253\\u5370\\u8C03\\u8BD5\\u4FE1\\u606F\\n   */\\n  protected debugging?: boolean;\\n\\n  constructor(options?: Partial<Options>) {\\n    const {\\n      name = '',\\n      reconnectMaxCount = 10,\\n      reconnectTimeInterval = 1000,\\n      debugging = true,\\n    } = options || {};\\n\\n    this.name = name;\\n    this.disconnectFlag = false;\\n    this.reconnectCount = 0;\\n    this.RECONNECT_MAX_COUNT = reconnectMaxCount;\\n    this.RECONNECT_TIME_INTERVAL = reconnectTimeInterval;\\n    this.debugging = debugging;\\n  }\\n\\n  /**\\n   * \\u5EFA\\u7ACBwebsocket\\u8FDE\\u63A5\\n   * @param websocketUrl websocket\\u5730\\u5740\\n   * @param options \\u9009\\u9879\\n   */\\n  buildConnect(\\n    websocketUrl: string,\\n    options?: {\\n      /**\\n       * \\u521D\\u6B21\\u8FDE\\u63A5\\u6210\\u529F\\u7684\\u56DE\\u8C03\\n       */\\n      onFirstConnected?: () => void;\\n      /**\\n       * \\u6210\\u529F\\u63A5\\u6536\\u5230\\u6D88\\u606F\\u7684\\u56DE\\u8C03\\n       */\\n      onMessage?: (message: string) => void;\\n      /**\\n       * \\u91CD\\u8FDE\\u6210\\u529F\\u7684\\u56DE\\u8C03\\n       */\\n      onReconnectSuccess?: () => void;\\n      /**\\n       * \\u91CD\\u8FDE\\u5931\\u8D25\\u7684\\u56DE\\u8C03\\n       */\\n      onReconnectFailed?: () => void;\\n    },\\n  ) {\\n    const { onFirstConnected, onMessage, onReconnectSuccess, onReconnectFailed } = options || {};\\n\\n    if (!this.getWebSocketStatus()) {\\n      const ws = (this.ws = new WebSocket(websocketUrl));\\n\\n      ws.addEventListener('open', () => {\\n        if (this.reconnectCount > 0) {\\n          onReconnectSuccess?.();\\n        } else {\\n          onFirstConnected?.();\\n        }\\n\\n        this.reconnectCount = 0;\\n        this.debugging && console.log(`[WebSocket]${this.name}: \\u8FDE\\u63A5\\u6210\\u529F`);\\n      });\\n\\n      ws.addEventListener('message', (e) => {\\n        this.debugging && console.log(`[WebSocket]${this.name}: \\u6536\\u5230\\u6D88\\u606F`, e.data);\\n        onMessage?.(e.data);\\n      });\\n\\n      ws.addEventListener('close', () => {\\n        // \\u7528\\u6237\\u4E3B\\u52A8\\u65AD\\u5F00\\u8FDE\\u63A5 \\u5219\\u4E0D\\u91CD\\u8FDE\\n        if (this.disconnectFlag) {\\n          this.reconnectCount = 0;\\n          this.debugging && console.log(`[WebSocket]${this.name}: \\u5DF2\\u65AD\\u5F00\\u8FDE\\u63A5`);\\n          return;\\n        }\\n\\n        this.debugging && console.log(`[WebSocket]${this.name}: \\u6B63\\u5728\\u81EA\\u52A8\\u91CD\\u8FDE...`);\\n\\n        this.reconnectTimer = setTimeout(() => {\\n          this.reconnectCount += 1;\\n          this.debugging && console.log(`[WebSocket]${this.name}: \\u91CD\\u8FDE\\u6B21\\u6570 ${this.reconnectCount}`);\\n\\n          if (this.reconnectCount >= this.RECONNECT_MAX_COUNT) {\\n            this.debugging && console.log(`[WebSocket]${this.name}: \\u8FDE\\u63A5\\u5931\\u8D25`);\\n            clearTimeout(this.reconnectTimer);\\n            onReconnectFailed?.();\\n            return;\\n          }\\n\\n          this.buildConnect(websocketUrl, options);\\n        }, this.RECONNECT_TIME_INTERVAL);\\n      });\\n    }\\n  }\\n\\n  /**\\n   * \\u83B7\\u53D6\\u8FDE\\u63A5\\u72B6\\u6001\\n   * @return boolean\\n   */\\n  getWebSocketStatus() {\\n    let status = false;\\n    if (this.ws && this.ws.readyState) {\\n      status = this.ws.readyState === 1;\\n    }\\n    this.debugging &&\\n      console.log(`[WebSocket]${this.name} \\u8FDE\\u63A5\\u72B6\\u6001: ${status ? '\\u5DF2\\u8FDE\\u63A5' : '\\u672A\\u8FDE\\u63A5'}`);\\n    return status;\\n  }\\n\\n  /**\\n   * \\u53D1\\u9001\\u6570\\u636E\\n   * @param data\\n   */\\n  sendMessage(data: string) {\\n    if (this.getWebSocketStatus()) {\\n      this.ws?.send(data);\\n    }\\n  }\\n\\n  /**\\n   * \\u5173\\u95ED\\u8FDE\\u63A5\\n   */\\n  close() {\\n    if (this.getWebSocketStatus()) {\\n      this.disconnectFlag = true;\\n      this.ws?.close();\\n      this.reconnectTimer && clearTimeout(this.reconnectTimer);\\n    }\\n  }\\n}\\n\")), mdx(\"h3\", null, \"\\u6D4B\\u8BD5\\u5B9E\\u4F8B\"), mdx(\"p\", null, \"\\u524D\\u7AEF\\u4EE3\\u7801\\uFF1A\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-tsx\"\n  }, \"import InstantWS from '@/utils/InstantWS';\\n\\nconst wsUrl = 'ws://localhost:8181/';\\n\\nuseEffect(() => {\\n  const ws = new InstantWS({\\n    name: '\\u8FDE\\u63A51',\\n  });\\n\\n  ws.buildConnect(wsUrl, {\\n    onMessage(message) {\\n      const msg = JSON.parse(message);\\n      console.log(msg);\\n    },\\n  });\\n\\n  return () => {\\n    ws.close();\\n  }\\n}, []);\\n\")), mdx(\"h2\", null, \"\\u5B9A\\u5236trigger\\u4E0B\\u62C9\\u5185\\u5BB9\"), mdx(\"h3\", null, \"\\u6548\\u679C\\u9884\\u89C8\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/images/2022-12-13/custom-select.png\",\n    \"alt\": \"custom-select\"\n  })), mdx(\"h3\", null, \"\\u80CC\\u666F\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/images/2022-12-13/final.png\",\n    \"alt\": \"final\"\n  })), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"\\u7CFB\\u7EDF\\u5185\\u7684\\u67E5\\u8BE2\\u7EC4\\u4EF6\\u90FD\", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"\\u6CA1\\u6709label\"), \"\\uFF0C\\u6240\\u6709\\u67E5\\u8BE2\\u7EC4\\u4EF6\\u90FD\\u662F\\u901A\\u8FC7 \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"placeholder\"), \" \\u533A\\u5206\\u7684\\u3002\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"\\u6BD4\\u5982\\u8FD9\\u4E2A\\u9875\\u9762\\u7684\\u67E5\\u8BE2\\u7EC4\\u4EF6\\uFF0C\\u5C31\\u6709\\u4E24\\u4E2A\\u6570\\u503C\\u8303\\u56F4\\u67E5\\u8BE2\\u7EC4\\u4EF6\\u3002\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"\\u66F4\\u91CD\\u8981\\u7684\\u662F\\uFF0C\\u539F\\u578B\\u548CUI\\u90FD\\u53EA\\u753B\\u4E86\\u4E24\\u4E2A\\u8F93\\u5165\\u6846\\uFF0C\\u53EA\\u80FD\\u4F7F\\u7528 \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Select\"), \" \\u4E0B\\u62C9\\u6846\\u7684\\u6A21\\u5F0F\\u3002\")), mdx(\"p\", null, \"\\u4F46\\u662F antd \\u7684 Select \\u5B9A\\u5236\\u7684\\u81EA\\u7531\\u5EA6\\u4E0D\\u591F\\u9AD8\\u3002\"), mdx(\"h3\", null, \"\\u5206\\u6790\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"\\u4E0A\\u9762\\u7684\\u90E8\\u5206 (selector) \\u548C\\u4E0B\\u9762\\u7684\\u90E8\\u5206 (popup)\\uFF0C\\u4EE5\\u53CA\\u4E24\\u8005\\u7684\\u6570\\u636E\\u5904\\u7406\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"\\u70B9\\u51FB selector \\u663E\\u793A popup\\uFF0C\", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"\\u50CF antd \\u7684 Select \\u7EC4\\u4EF6\\u4E00\\u6837\\u6709\\u8FC7\\u6E21\\u52A8\\u753B\"), \" \")), mdx(\"h3\", null, \"\\u65B9\\u6848\\u9009\\u62E9\"), mdx(\"h4\", null, \"\\u65B9\\u6848\\u4E00\\uFF1A\\u4F7F\\u7528 Popover\"), mdx(\"p\", null, \"\\u4F7F\\u7528 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"antd\"), \" \\u7684 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Popover\"), \" \\u7EC4\\u4EF6\\uFF0C\\u529F\\u80FD\\u90FD\\u53EF\\u4EE5\\u5B9E\\u73B0\\uFF0C\\u552F\\u4E00\\u7684\\u7F3A\\u61BE\\u5C31\\u662F antd \\u5728\\u8BBE\\u8BA1 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Select\"), \" \\u7EC4\\u4EF6\\u7684\\u65F6\\u5019\\u4E0B\\u62C9\\u90E8\\u5206(\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"popup\"), \") \\u5E94\\u7528\\u7684\\u662F \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"slide\"), \" \\u8FC7\\u6E21\\u52A8\\u753B\\uFF0C\\u800C \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Popover\"), \" \\u7EC4\\u4EF6\\u5E94\\u7528\\u7684\\u662F \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"zoom\"), \" \\u8FC7\\u6E21\\u52A8\\u753B\\uFF0C\\u4F53\\u9A8C\\u8D77\\u6765\\u5C31\\u6709\\u70B9\\u522B\\u626D\\u3002\"), mdx(\"p\", null, \"\\u5177\\u4F53\\u5B9E\\u73B0\\u53EF\\u53C2\\u8003\\u5B98\\u65B9\\u6848\\u4F8B\\uFF1A\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://ant-design.gitee.io/components/popover-cn/#components-popover-demo-hover-with-click\"\n  }, \"\\u60AC\\u505C\\u70B9\\u51FB\\u5F39\\u51FA\\u7A97\\u53E3\"), \" \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-tsx\"\n  }, \"<Popover\\n  content={/* popup */}\\n  trigger=\\\"click\\\"\\n  open={clicked}\\n  onOpenChange={handleClickChange}\\n  placement={placement}\\n  overlayClassName={styles.popover}\\n>\\n  {/* selector */}\\n</Popover>\\n\")), mdx(\"h4\", null, \"\\u65B9\\u6848\\u4E8C\\uFF1A\\u6A21\\u4EFF Select \\u7684\\u5B9E\\u73B0\"), mdx(\"h5\", null, \"\\u5B9E\\u73B0\\u7ED3\\u6784\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"antd \\u7684 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Select\"), \" \\u7EC4\\u4EF6\"), mdx(\"blockquote\", {\n    parentName: \"li\"\n  }, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/ant-design/ant-design/blob/master/components/select/index.tsx\"\n  }, \"ant-design \\u7684 Select \\u7EC4\\u4EF6\"), \" \\u662F\\u57FA\\u4E8E \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rc-select\"), \" \\u7EC4\\u4EF6\\u5C01\\u88C5\\u7684\\u3002\")), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-tsx\"\n  }, \"import RcSelect, { BaseSelectRef, OptGroup, Option } from 'rc-select';\\n\"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rc-select\"), \" \\u7EC4\\u4EF6\"), mdx(\"blockquote\", {\n    parentName: \"li\"\n  }, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/react-component/select/blob/master/src/Select.tsx\"\n  }, \"rc-select\"), \"  \\u7EC4\\u4EF6\\u7684 popup \\u662F\\u57FA\\u4E8E \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rc-trigger\"), \" \\u7EC4\\u4EF6\\u5C01\\u88C5\\u7684\\u3002\")), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-tsx\"\n  }, \"// \\u5F15\\u5165\\u4E86 BaseSelect\\nimport BaseSelect, { isMultiple } from './BaseSelect';\\n\\n// \\u8FDB\\u5165 BaseSelect.tsx \\u6587\\u4EF6\\u67E5\\u770B\\uFF0C\\u67E5\\u627E\\u4E0E dropdown \\u6709\\u5173\\u7684\\u5B9E\\u73B0\\nimport SelectTrigger from './SelectTrigger';\\n\\n// \\u8FDB\\u5165 SelectTrigger.tsx \\u6587\\u4EF6\\u67E5\\u770B\\nimport Trigger from 'rc-trigger';\\n\"))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rc-trigger\"), \" \\u7EC4\\u4EF6\"), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u6839\\u636E\\u6587\\u6863\\u4E2D\\u7684\\u53C2\\u6570\\u542B\\u4E49\\u89E3\\u91CA\\uFF0C\\u4EE5\\u53CA\\u5728 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rc-select\"), \" \\u4E2D\\u7684\\u5199\\u6CD5\\uFF0C\\u57FA\\u672C\\u80FD\\u5B9E\\u73B0\\u529F\\u80FD\\u4E86\\u3002\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-shell\"\n  }, \"npm i -S rc-dropdown rc-trigger\\n\")), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-tsx\"\n  }, \"import Trigger from 'rc-trigger';\\nimport placements from 'rc-dropdown/lib/placements';\\n\\n// ...\\n\\n<Trigger\\n  action={['click']}\\n  builtinPlacements={placements}\\n  popup={/* popup */}\\n  popupStyle={{ width: 280 }}\\n  popupVisible={mergedVisible}\\n  onPopupVisibleChange={onVisibleChange}\\n  popupPlacement={placement}\\n  prefixCls=\\\"range-dropdown\\\"\\n  stretch=\\\"width\\\"\\n  getPopupContainer={getPopupContainer}\\n>\\n  {/* selector */}\\n</Trigger>\\n\")))), mdx(\"h5\", null, \"popup \\u6DFB\\u52A0\\u8FC7\\u6E21\\u52A8\\u753B\"), mdx(\"p\", null, \"\\u65E2\\u7136\\u8981\\u548C antd \\u7684 Select \\u505A\\u7C7B\\u4F3C\\u6548\\u679C\\uFF0C\\u90A3\\u6700\\u597D\\u80FD\\u76F4\\u63A5\\u590D\\u7528 antd \\u76F8\\u5173\\u7684\\u5B9E\\u73B0\\u4EE3\\u7801\\u3002\\u6240\\u4EE5\\u53BB\\u8BFB antd \\u6E90\\u7801\\uFF0C\\u4E86\\u89E3 popup \\u76F8\\u5173\\u7684\\u52A8\\u753B\\u5B9E\\u73B0\\u3002\"), mdx(\"p\", null, \"\\u5728 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rc-trigger\"), \" \\u7EC4\\u4EF6\\u6587\\u6863\\u4E2D\\uFF0C\\u627E\\u5230\\u4E86 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"popupTransitionName\"), \" \\u8FD9\\u4E2A\\u5C5E\\u6027\\uFF0C\\u548C popup \\u7684\\u8FC7\\u6E21\\u52A8\\u753B\\u5B9E\\u73B0\\u6709\\u5173\\u3002\\u987A\\u7740 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rc-trigger\"), \" => \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rc-select\"), \" => \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"antd Select\"), \" \\u7EC4\\u4EF6\\u53D1\\u73B0\\u8FD9\\u4E2A\\u5C5E\\u6027\\u662F\\u4E00\\u5C42\\u5C42\\u4F20\\u9012\\u4E0B\\u6765\\u7684\\u3002\\u6240\\u4EE5\\u53EA\\u9700\\u8981\\u770B antd \\u7684 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Select\"), \" \\u5B9E\\u73B0\\u3002\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-tsx\"\n  }, \"import { getTransitionDirection, getTransitionName } from '../_util/motion';\\n\\n<RcSelect\\n  ...\\n  transitionName={getTransitionName(\\n    rootPrefixCls,\\n    getTransitionDirection(placement),\\n    props.transitionName,\\n  )}\\n  ...\\n/>\\n\")), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"getTransitionDirection\"), \" - \\u6839\\u636E placement\\uFF08popup \\u7684\\u4F4D\\u7F6E\\uFF09\\u51B3\\u5B9A\\u4F7F\\u7528\\u4F55\\u79CD\\u8FC7\\u6E21\\u52A8\\u753B \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"slide-down\"), \" / \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"slide-up\"), \" \\u3002\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"getTransitionName\"), \" - \\u5BF9 css \\u7C7B\\u540D\\u8FDB\\u884C\\u62FC\\u63A5\\uFF0C\\u5728 antd \\u7EC4\\u4EF6\\u5E93\\u4E2D\\u6240\\u6709 css \\u7C7B\\u540D\\u90FD\\u662F \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ant-xxx\"), \" \\u7684\\u683C\\u5F0F\\uFF0C\\u5982\\u679C\\u540E\\u9762\\u60F3\\u8981\\u5E94\\u7528 antd \\u7684\\u6837\\u5F0F\\uFF0C\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rootPrefixCls\"), \" \\u591A\\u534A\\u4E5F\\u662F\\u4F20 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ant\"), \" \\u3002\"), mdx(\"p\", null, \"\\u7136\\u540E\\u53BB\\u76F8\\u5173\\u7684 less \\u6587\\u4EF6\\u4E2D\\u627E\\u627E\\u76F8\\u5173\\u5B9E\\u73B0\\u9A8C\\u8BC1\\u4E00\\u4E0B\\u3002\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-less\"\n  }, \"/* ant-design\\\\components\\\\select\\\\styles\\\\index.less */\\n@import '../../style/themes/index';\\n@import '../../style/mixins/index';\\n@import '../../input/style/mixin';\\n\\n// ========================== Popup ==========================\\n&-dropdown {\\n  ...\\n  &.@{ant-prefix}-slide-up-enter.@{ant-prefix}-slide-up-enter-active&-placement-bottomLeft,\\n  &.@{ant-prefix}-slide-up-appear.@{ant-prefix}-slide-up-appear-active&-placement-bottomLeft {\\n    animation-name: antSlideUpIn;\\n  }\\n\\n  &.@{ant-prefix}-slide-up-enter.@{ant-prefix}-slide-up-enter-active&-placement-topLeft,\\n  &.@{ant-prefix}-slide-up-appear.@{ant-prefix}-slide-up-appear-active&-placement-topLeft {\\n    animation-name: antSlideDownIn;\\n}\\n\\n  &.@{ant-prefix}-slide-up-leave.@{ant-prefix}-slide-up-leave-active&-placement-bottomLeft {\\n    animation-name: antSlideUpOut;\\n  }\\n\\n  &.@{ant-prefix}-slide-up-leave.@{ant-prefix}-slide-up-leave-active&-placement-topLeft {\\n    animation-name: antSlideDownOut;\\n  }\\n\\n  ...\\n}\\n\")), mdx(\"p\", null, \"\\u8FD9\\u91CC\\u4F7F\\u7528\\u4E864\\u79CD css \\u52A8\\u753B\\uFF0C\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"antSlideUpIn\"), \" / \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"antSlideDownIn\"), \" / \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"antSlideUpOut\"), \" / \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"antSlideDownOut\"), \" \\u3002\"), mdx(\"p\", null, \"\\u6700\\u540E\\u5728 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ant-design\\\\components\\\\style\\\\core\\\\motion\\\\slide.less\"), \" \\u4E2D\\u627E\\u5230\\u4E86\\u5B83\\u4EEC\\u7684\\u5B9A\\u4E49\\u3002\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-less\"\n  }, \".slide-motion(@className, @keyframeName) {\\n  @name: ~'@{ant-prefix}-@{className}';\\n  .make-motion(@name, @keyframeName);\\n  .@{name}-enter,\\n  .@{name}-appear {\\n    opacity: 0;\\n    animation-timing-function: @ease-out-quint;\\n  }\\n  .@{name}-leave {\\n    animation-timing-function: @ease-in-quint;\\n  }\\n}\\n\\n.slide-motion(slide-up, antSlideUp);\\n.slide-motion(slide-down, antSlideDown);\\n.slide-motion(slide-left, antSlideLeft);\\n.slide-motion(slide-right, antSlideRight);\\n\\n@keyframes antSlideUpIn {\\n  0% {\\n    transform: scaleY(0.8);\\n    transform-origin: 0% 0%;\\n    opacity: 0;\\n  }\\n\\n  100% {\\n    transform: scaleY(1);\\n    transform-origin: 0% 0%;\\n    opacity: 1;\\n  }\\n}\\n\\n@keyframes antSlideUpOut {\\n  0% {\\n    transform: scaleY(1);\\n    transform-origin: 0% 0%;\\n    opacity: 1;\\n  }\\n\\n  100% {\\n    transform: scaleY(0.8);\\n    transform-origin: 0% 0%;\\n    opacity: 0;\\n  }\\n}\\n\\n@keyframes antSlideDownIn {\\n  0% {\\n    transform: scaleY(0.8);\\n    transform-origin: 100% 100%;\\n    opacity: 0;\\n  }\\n\\n  100% {\\n    transform: scaleY(1);\\n    transform-origin: 100% 100%;\\n    opacity: 1;\\n  }\\n}\\n\\n@keyframes antSlideDownOut {\\n  0% {\\n    transform: scaleY(1);\\n    transform-origin: 100% 100%;\\n    opacity: 1;\\n  }\\n\\n  100% {\\n    transform: scaleY(0.8);\\n    transform-origin: 100% 100%;\\n    opacity: 0;\\n  }\\n}\\n\\n@keyframes antSlideLeftIn {\\n  0% {\\n    transform: scaleX(0.8);\\n    transform-origin: 0% 0%;\\n    opacity: 0;\\n  }\\n\\n  100% {\\n    transform: scaleX(1);\\n    transform-origin: 0% 0%;\\n    opacity: 1;\\n  }\\n}\\n\\n@keyframes antSlideLeftOut {\\n  0% {\\n    transform: scaleX(1);\\n    transform-origin: 0% 0%;\\n    opacity: 1;\\n  }\\n\\n  100% {\\n    transform: scaleX(0.8);\\n    transform-origin: 0% 0%;\\n    opacity: 0;\\n  }\\n}\\n\\n@keyframes antSlideRightIn {\\n  0% {\\n    transform: scaleX(0.8);\\n    transform-origin: 100% 0%;\\n    opacity: 0;\\n  }\\n\\n  100% {\\n    transform: scaleX(1);\\n    transform-origin: 100% 0%;\\n    opacity: 1;\\n  }\\n}\\n\\n@keyframes antSlideRightOut {\\n  0% {\\n    transform: scaleX(1);\\n    transform-origin: 100% 0%;\\n    opacity: 1;\\n  }\\n\\n  100% {\\n    transform: scaleX(0.8);\\n    transform-origin: 100% 0%;\\n    opacity: 0;\\n  }\\n}\\n\")), mdx(\"p\", null, \"less \\u53D8\\u91CF \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ant-prefix\"), \" \\u7684\\u5B9A\\u4E49\\u5728 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ant-design\\\\components\\\\style\\\\themes\\\\variable.less\"), \" \\u4E2D\\u3002\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-less\"\n  }, \"// The prefix to use on all css classes from ant.\\n@ant-prefix: ant;\\n\")), mdx(\"p\", null, \"\\u7EFC\\u4E0A\\u6240\\u8FF0\\uFF0C\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rc-trigger\"), \"  \\u7EC4\\u4EF6\\u5728\\u6B64\\u5904\\u7684\\u7528\\u6CD5\\u662F\\uFF1A\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-tsx\"\n  }, \"import { getTransitionDirection, getTransitionName } from 'antd/es/_util/motion';\\n\\n<Trigger\\n  action={['click']}\\n  builtinPlacements={placements}\\n  popup={/* popup */}\\n  popupStyle={{ width: 280 }}\\n  popupVisible={mergedVisible}\\n  onPopupVisibleChange={onVisibleChange}\\n  popupPlacement={placement}\\n  prefixCls=\\\"range-dropdown\\\"\\n  stretch=\\\"width\\\"\\n  getPopupContainer={getPopupContainer}\\n  popupTransitionName={getTransitionName('ant', getTransitionDirection(placement))}\\n>\\n  {/* selector */}\\n</Trigger>\\n\")), mdx(\"p\", null, \"\\u76F4\\u63A5\\u7528 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"popupTransitionName\"), \" \\u5C5E\\u6027\\u4F1A\\u63D0\\u793A\\u8BE5\\u5C5E\\u6027\\u5DF2\\u5F03\\u7528\\uFF0C\\u5EFA\\u8BAE\\u4F7F\\u7528 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"popupMotion\"), \" \\u5C5E\\u6027\\uFF0C\\u53EF\\u4EE5\\u6539\\u6210\\u4E0B\\u9762\\u7684\\u5199\\u6CD5\\u3002\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-tsx\"\n  }, \"import { getTransitionDirection, getTransitionName } from 'antd/es/_util/motion';\\n\\n<Trigger\\n  action={['click']}\\n  builtinPlacements={placements}\\n  popup={/* popup */}\\n  popupStyle={{ width: 280 }}\\n  popupVisible={mergedVisible}\\n  onPopupVisibleChange={onVisibleChange}\\n  popupPlacement={placement}\\n  prefixCls=\\\"range-dropdown\\\"\\n  stretch=\\\"width\\\"\\n  getPopupContainer={getPopupContainer}\\n  popupMotion={{\\n    motionName: getTransitionName('ant', getTransitionDirection(placement)),\\n  }}\\n>\\n  {/* selector */}\\n</Trigger>\\n\")), mdx(\"h3\", null, \"\\u5B8C\\u6574\\u5B9E\\u73B0\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-tsx\"\n  }, \"import React, { useMemo, useRef, useState } from 'react';\\nimport type { FC } from 'react';\\nimport { Button, Popover } from 'antd';\\nimport { CloseCircleFilled, DownOutlined } from '@ant-design/icons';\\nimport Trigger from 'rc-trigger';\\nimport placements from 'rc-dropdown/lib/placements';\\nimport Range from './Range';\\nimport type { ValueType } from './Range';\\nimport styles from './index.less';\\nimport { getTransitionDirection, getTransitionName } from 'antd/es/_util/motion';\\n\\n// \\u6837\\u5F0F\\u7C7B\\u540D\\u524D\\u7F00\\nconst prefixCls = 'number-range';\\n\\nexport type RangeSelectProps = {\\n  allowClear?: boolean;\\n  value?: ValueType;\\n  onChange?: (value?: ValueType) => void;\\n  placeholder?: string;\\n  /** \\u56DE\\u663E\\u6570\\u503C\\u524D\\u7F00 */\\n  renderPrefix?: string;\\n  /** \\u56DE\\u663E\\u5206\\u9694\\u7B26 */\\n  renderSeparator?: string;\\n  /** \\u9009\\u62E9\\u6846\\u6837\\u5F0F */\\n  style?: React.CSSProperties;\\n  /** dropdown \\u5F39\\u51FA\\u4F4D\\u7F6E */\\n  placement?: 'bottomLeft' | 'bottomRight' | 'topLeft' | 'topRight';\\n  /** dropdown \\u662F\\u5426\\u663E\\u793A */\\n  visible?: boolean;\\n  /** dropdown \\u663E\\u793A\\u72B6\\u6001\\u6539\\u53D8\\u65F6\\u8C03\\u7528 */\\n  onVisibleChange?: (visible: boolean) => void;\\n  getPopupContainer?: (triggerNode: HTMLElement) => HTMLElement;\\n};\\n\\nconst RangeSelect: FC<RangeSelectProps> = (props) => {\\n  const {\\n    allowClear = false,\\n    value,\\n    onChange,\\n    placeholder = '\\u8BF7\\u9009\\u62E9\\u8303\\u56F4',\\n    placement = 'bottomLeft',\\n    style,\\n    renderPrefix = '',\\n    renderSeparator = '-',\\n    visible,\\n    getPopupContainer,\\n  } = props;\\n  const [rangeValue, setRangeValue] = useState<ValueType>();\\n  const [triggerVisible, setTriggerVisible] = useState<boolean>(false);\\n  const wrapperRef = useRef<HTMLDivElement>(null);\\n\\n  const mergedVisible = visible !== undefined ? visible : triggerVisible;\\n\\n  const triggerRef = React.useRef(null);\\n\\n  const handleClear: React.MouseEventHandler<HTMLSpanElement> = (event) => {\\n    setRangeValue(undefined);\\n    onChange?.(undefined);\\n\\n    event.stopPropagation();\\n  };\\n\\n  const handleOk = () => {\\n    onChange?.(rangeValue);\\n    setTriggerVisible(false);\\n  };\\n\\n  const handleCancel = () => {\\n    setRangeValue(undefined);\\n    setTriggerVisible(false);\\n  };\\n\\n  const onRangeValueChange = (value?: ValueType) => {\\n    setRangeValue(value);\\n  };\\n\\n  const onVisibleChange = (newVisible: boolean) => {\\n    setTriggerVisible(newVisible);\\n    props.onVisibleChange?.(newVisible);\\n  };\\n\\n  const renderedValue = useMemo(() => {\\n    const isMinEmpty = value?.min === undefined || value.min === null;\\n    const isMaxEmpty = value?.max === undefined || value.max === null;\\n\\n    if (isMinEmpty && isMaxEmpty) {\\n      return undefined;\\n    } else if (isMinEmpty && !isMaxEmpty) {\\n      return `\\u4E0D\\u8BBE\\u4E0B\\u9650 ${renderSeparator} ${renderPrefix}${value.max}`;\\n    } else if (!isMinEmpty && isMaxEmpty) {\\n      return `${renderPrefix}${value.min} ${renderSeparator} \\u4E0D\\u8BBE\\u4E0A\\u9650`;\\n    } else {\\n      return `${renderPrefix}${value.min} ${renderSeparator} ${renderPrefix}${value.max}`;\\n    }\\n  }, [value]);\\n\\n  const getPopup = () => (\\n    <div className={styles.dropdown}>\\n      {/* \\u6570\\u503C\\u8303\\u56F4\\u8F93\\u5165\\u7EC4\\u4EF6 */}    \\n      <Range value={rangeValue} onChange={onRangeValueChange} withoutForm />\\n\\n      <div className={styles.btns}>\\n        <Button type=\\\"primary\\\" className={styles.btn} onClick={handleOk}>\\n          \\u786E\\u8BA4\\n        </Button>\\n        <Button className={`${styles.btn} ${styles.btnCancel}`} onClick={handleCancel}>\\n          \\u53D6\\u6D88\\n        </Button>\\n      </div>\\n    </div>\\n  );\\n\\n  return (\\n    <Trigger\\n      action={['click']}\\n      builtinPlacements={placements}\\n      popup={getPopup()}\\n      popupStyle={{ width: 280 }}\\n      popupVisible={mergedVisible}\\n      onPopupVisibleChange={onVisibleChange}\\n      popupPlacement={placement}\\n      prefixCls={`${prefixCls}-dropdown`}\\n      stretch=\\\"width\\\"\\n      ref={triggerRef}\\n      getPopupContainer={getPopupContainer}\\n      popupMotion={{\\n        motionName: getTransitionName('ant', getTransitionDirection(placement)),\\n      }}\\n    >\\n      <div\\n        className={`${styles.rangeSelect} ${mergedVisible ? styles.focused : ''}`}\\n        style={style}\\n        ref={wrapperRef}\\n      >\\n        <div className={styles.selector}>\\n          {renderedValue ? (\\n            <span className={styles.selectedItem}>{renderedValue}</span>\\n          ) : (\\n            <span className={styles.placeholder}>{placeholder}</span>\\n          )}\\n        </div>\\n\\n        <DownOutlined className={styles.arrow} />\\n\\n        {allowClear && (\\n          <CloseCircleFilled\\n            className={`${styles.clear} ${renderedValue ? styles.visible : ''}`}\\n            onClick={handleClear}\\n          />\\n        )}\\n      </div>\\n    </Trigger>\\n  );\\n};\\n\\nexport default RangeSelect;\\n\")));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"date":"2022-12-13 19:35:02","title":"websocket封装&antd组件过渡动画应用","slug":"/blog/websocket-tool-and-antd-transition"}}},"pageContext":{"slug":"/blog/websocket-tool-and-antd-transition","next":"/blog/hls-m3u8","previous":"/blog/color-picker-and-clipboard"}},"staticQueryHashes":[]}