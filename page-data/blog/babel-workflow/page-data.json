{"componentChunkName":"component---src-templates-blog-detail-js","path":"/blog/babel-workflow","result":{"data":{"mdx":{"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"slug\": \"/blog/babel-workflow\",\n  \"title\": \"Babel工作流程\",\n  \"date\": \"2024-03-06 19:59:03\",\n  \"brief\": \"在上一篇中了解了babel相关的packages，不免会好奇babel内部到底是如何工作的。我粗略阅读了babel的一些源码，并且结合网上其他人的分享，简单总结了babel内部的工作流程。\",\n  \"tag\": \"nodejs\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u7248\\u672C\\u4FE1\\u606F\\uFF1A@babel/core 7.x\"), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u53C2\\u8003\\u8D44\\u6599\\uFF1A\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md\"\n  }, \"babel-handbook \\u63D2\\u4EF6\\u5F00\\u53D1\\u624B\\u518C\"), \" \")), mdx(\"h2\", null, \"\\u524D\\u60C5\\u56DE\\u987E\"), mdx(\"p\", null, \"babel\\u7F16\\u8BD1\\u73AF\\u5883\\u642D\\u5EFA\\u9700\\u8981\\u4E0B\\u9762\\u4E09\\u7C7B\\u5305\\uFF1A\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/images/2024-02-26/20240226160335.png\",\n    \"alt\": \"babel编译环境搭建\"\n  })), mdx(\"p\", null, \"@babel/core \\u662F babel \\u5728\\u7F16\\u8BD1\\u4EE3\\u7801\\u8FC7\\u7A0B\\u4E2D\\u7684\\u6838\\u5FC3\\u5E93\\uFF0C\\u5BF9\\u4EE3\\u7801\\u8FDB\\u884C \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"\\u8BCD\\u6CD5\\u5206\\u6790--\\u8BED\\u6CD5\\u5206\\u6790--\\u8BED\\u4E49\\u5206\\u6790\"), \" \\u5904\\u7406\\u8FC7\\u7A0B\\uFF0C\\u4ECE\\u800C\\u751F\\u6210 AST \\u62BD\\u8C61\\u8BED\\u6CD5\\u6811\\u3002\"), mdx(\"img\", {\n    src: \"/images/2024-02-26/20240226162305.png\",\n    alt: \"babel-loader\\u4F2A\\u4EE3\\u7801\",\n    style: {\n      \"zoom\": \"80%\"\n    }\n  }), mdx(\"h2\", null, \"\\u6D41\\u7A0B\\u68B3\\u7406\"), mdx(\"p\", null, \"\\u4ECE\\u6E90\\u7801\\u4E2D\\u67E5\\u770B transform API \\u5185\\u90E8\\u5B8C\\u6210\\u7684\\u6838\\u5FC3\\u4EFB\\u52A1\\u3002\"), mdx(\"h3\", null, \"\\u8BFB\\u53D6babel\\u914D\\u7F6E\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/images/2024-02-26/20240227135156976.png\",\n    \"alt\": \"image-20240227135156976\"\n  })), mdx(\"p\", null, \"\\u4E3A\\u4EC0\\u4E48\\u989D\\u5916\\u5F15\\u5165json5\\u8FD9\\u4E2A\\u5305\\uFF1F\"), mdx(\"p\", null, \"babel\\u7684\\u914D\\u7F6E\\u6587\\u4EF6\\u652F\\u6301json5\\uFF08json\\u7684\\u6269\\u5C55\\u683C\\u5F0F\\uFF09\\uFF0C\\u4E0D\\u540C\\u4E8E\\u666E\\u901Ajson\\u683C\\u5F0F\\uFF0C\\u6269\\u5C55\\u4E86\\u5F88\\u591A\\u65B0\\u7279\\u6027\\uFF0C\\u4E0D\\u989D\\u5916\\u5F15\\u5165\\u5305\\u5219\\u65E0\\u6CD5\\u5904\\u7406\\u3002\"), mdx(\"p\", null, \"\\u6BD4\\u5982 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"webpack-main/bin/webpack.js > runCli()\"), \" \\u4E2D\\u8BFB\\u53D6package.json\\u7684\\u914D\\u7F6E\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"const pkgPath = require.resolve(`${cli.package}/package.json`);\\nconst content = require(pkgPath);\\n\")), mdx(\"p\", null, \"\\u4E0A\\u8FF0\\u4EE3\\u7801\\u5904\\u7406\\u7684\\u6587\\u4EF6\\u4E2D\\u4E0D\\u80FD\\u5305\\u542B\\u6CE8\\u91CA\\uFF0C\\u5426\\u5219\\u4F1A\\u629B\\u51FA\\u5F02\\u5E38\\u3002\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/images/2024-02-26/20240227140008900.png\",\n    \"alt\": \"image-20240227140008900\"\n  })), mdx(\"h3\", null, \"\\u5904\\u7406\\u914D\\u7F6E\\u9879\"), mdx(\"h4\", null, \"Plugin & Preset \\u7684\\u57FA\\u672C\\u683C\\u5F0F\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Plugin\\u7684\\u57FA\\u672C\\u683C\\u5F0F\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"module.exports = function(api, opts, dirname) {\\n  return {\\n    name: 'plugin-name',\\n    visitor: {\\n      BinaryExpression(path) {\\n        ...\\n      }\\n    },\\n    pre(file) { ... },\\n    post(file) { ... },\\n    manipulateOptions(opts, parserOpts) { ... } // \\u8C03\\u6574\\u914D\\u7F6E\\uFF0C\\u591A\\u7528\\u4E8E plugin-syntax-xxx\\n  };\\n};\\n\")), mdx(\"p\", null, \"\\u4E0D\\u4F7F\\u7528 api, opts, dirname \\u8FD9\\u4E09\\u4E2A\\u53C2\\u6570\\u65F6\\uFF0C\\u53EF\\u4EE5\\u53EA\\u5BFC\\u51FA\\u91CC\\u9762\\u7684\\u5BF9\\u8C61\\u3002\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"module.exports = {\\n  name: 'plugin-name',\\n  visitor: {\\n    BinaryExpression() {\\n      ...\\n    }\\n  },\\n};\\n\")), mdx(\"p\", null, \"visitor \\u5BF9\\u8C61\\u7684 key \\u8868\\u793AAST Node\\u7C7B\\u578B\\uFF0C\\u5B9A\\u4E49\\u5728 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"@babel/types\"), \" \\u8FD9\\u4E2A\\u5305\\u91CC\\u9762\\u3002\"), mdx(\"p\", null, \"\\u7531\\u4E8E AST Node \\u7C7B\\u578B\\u4F17\\u591A\\uFF0C\\u53EF\\u4EE5\\u501F\\u52A9 \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://astexplorer.net/\"\n  }, \"https://astexplorer.net/\"), \" \\u67E5\\u770B\\u6E90\\u4EE3\\u7801\\u8F6C\\u6362\\u7684 AST \\u7ED3\\u6784\\u3002\"), mdx(\"p\", null, \"visitor \\u5C5E\\u6027\\u7684\\u5B8C\\u6574\\u5199\\u6CD5\\u5982\\u4E0B\\uFF1A\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"BinaryExpression: {\\n  enter(path) {\\n    ...\\n  },\\n  exit(path) {\\n    ...  \\n  }\\n}\\n\")), mdx(\"p\", null, \" \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"BinaryExpression() { ... }\"), \" \\u662F \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"BinaryExpression: { enter() { ... } }\"), \" \\u7684\\u7B80\\u5199\\u5F62\\u5F0F\\u3002.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Preset\\u7684\\u57FA\\u672C\\u683C\\u5F0F\"), \" \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"module.exports = function(api, opts, dirname) {\\n  return {\\n    presets: [...],\\n    plugins: [...],\\n  };\\n};\\n\\nmodule.exports = function(api, opts, dirname) {\\n  return {\\n    presets: [\\n      require('@babel/preset-env'),\\n      require('@babel/preset-react'),\\n      require('@babel/preset-typescript'),\\n    ],\\n    plugins: [],\\n  };\\n};\\n\")), mdx(\"p\", null, \"\\u4E0D\\u4F7F\\u7528 api, opts, dirname \\u8FD9\\u4E09\\u4E2A\\u53C2\\u6570\\u65F6\\uFF0C\\u53EF\\u4EE5\\u53EA\\u5BFC\\u51FA\\u91CC\\u9762\\u7684\\u5BF9\\u8C61\\u3002\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"module.exports = {\\n  presets: [...],\\n  plugins: [...],\\n};\\n\\n\\nmodule.exports = {\\n  presets: [\\n    require('@babel/preset-env'),\\n    require('@babel/preset-react'),\\n    require('@babel/preset-typescript'),\\n  ],\\n  plugins: [],\\n};\\n\")), mdx(\"h4\", null, \"\\u5904\\u7406\\u914D\\u7F6E\"), mdx(\"p\", null, \"\\u6E90\\u7801\\u4E2D\\u5BF9presets\\u548Cplugins\\u7B49\\u914D\\u7F6E\\u7684\\u5904\\u7406\\u5982\\u4E0B\\u56FE\\u6240\\u793A\\u3002\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/images/2024-02-26/20240227151512.png\",\n    \"alt\": \"20240227151512.png\"\n  })), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/images/2024-02-26/20240227151536.png\",\n    \"alt\": \"20240227151536.png\"\n  })), mdx(\"h3\", null, \"\\u8F6C\\u8BD1\\u4EE3\\u7801 run()\"), mdx(\"p\", null, \"\\u8F6C\\u8BD1\\u7684\\u6838\\u5FC3\\u6B65\\u9AA4\\u5982\\u4E0B\\u56FE\\u6240\\u793A\\u3002\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/images/2024-02-26/run-workflow.png\",\n    \"alt\": \"run-workflow.png\"\n  })), mdx(\"h4\", null, \"Parse \\u89E3\\u6790\"), mdx(\"p\", null, \"normalizeFile() \\u2014\\u2014 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"@babel/parser\"), \" \\uFF08code -> AST\\uFF09 \"), mdx(\"h4\", null, \"Transform \\u8F6C\\u6362\"), mdx(\"p\", null, \"transformFile()\"), mdx(\"p\", null, \"\\u524D\\u7F6E\\u5904\\u7406\\uFF1A\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u904D\\u5386 pluginPasses \\uFF08loadFullConfig\\u4E2D\\u7684 passes\\uFF0C\\u662F\\u4E2A\\u4E8C\\u7EF4\\u6570\\u7EC4\\uFF09\\uFF0C\\u5904\\u7406\\u91CC\\u9762\\u90A3\\u4E00\\u5C42\\uFF0C\\u8BB0\\u4F5C pluginPairs\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u904D\\u5386 pluginPairs\\uFF0C\\u4F9D\\u6B21\\u6267\\u884C\\u6BCF\\u4E00\\u9879 plugin.pre\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u904D\\u5386 pluginPairs\\uFF0C\\u83B7\\u53D6\\u5408\\u5E76\\u540E\\u7684 visitor\"), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"\\n{\\n    ...\\n    FunctionDeclaration: {\\n        enter: [ Function, Function, Function, Function, Function ],\\n        exit: [ Function ]\\n    },\\n    VariableDeclaration: {\\n        enter: [ Function, Function, Function, Function ] \\n    },\\n    ...\\n}\\n\\n\")), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u2014\\u2014 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"@babel/traverse\"), \"  \\u904D\\u5386\\u65E7\\u7684AST\\uFF0C\\u751F\\u6210\\u65B0\\u7684AST\"), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"AST\\u7ED3\\u6784\\u4EE5\\u4E0B\\u56FE\\u4E3A\\u4F8B\\u3002\"), mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/images/2024-02-26/node-ast.png\",\n    \"alt\": \"node-ast.png\"\n  }))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u904D\\u5386 pluginPairs\\uFF0C\\u4F9D\\u6B21\\u6267\\u884C\\u6BCF\\u4E00\\u9879 plugin.post\"))), mdx(\"h4\", null, \"Generate \\u751F\\u6210\"), mdx(\"p\", null, \"generateCode() \\u2014\\u2014 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"@babel/generator\"), \"  \\uFF08\\u904D\\u5386\\u65B0\\u7684AST\\uFF0C\\u751F\\u6210\\u5B57\\u7B26\\u4E32\\u5F62\\u5F0F\\u7684\\u4EE3\\u7801\\uFF09\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"\\u5907\\u6CE8\")), mdx(\"p\", null, \"babel\\u4E2DAST\\u7684\\u904D\\u5386\\u8FC7\\u7A0B\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u6DF1\\u5EA6\\u4F18\\u5148\\u904D\\u5386\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u57FA\\u4E8E\\u8BBF\\u95EE\\u8005\\u6A21\\u5F0F\\uFF08Visitor\\uFF09\"), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u8BBF\\u95EE\\u8005\\u6A21\\u5F0F\\uFF08Visitor Pattern\\uFF09\\u662F\\u4E00\\u4E2A\\u884C\\u4E3A\\u6A21\\u5F0F\\uFF0C\\u5C01\\u88C5\\u4E00\\u4E9B\\u4F5C\\u7528\\u4E8E\\u67D0\\u79CD\\u6570\\u636E\\u7ED3\\u6784\\u4E2D\\u7684\\u5404\\u5143\\u7D20\\u7684\\u64CD\\u4F5C\\uFF0C\\u5B83\\u53EF\\u4EE5\\u5728\\u4E0D\\u6539\\u53D8\\u6570\\u636E\\u7ED3\\u6784\\u7684\\u524D\\u63D0\\u4E0B\\u5B9A\\u4E49\\u4F5C\\u7528\\u4E8E\\u8FD9\\u4E9B\\u5143\\u7D20\\u7684\\u65B0\\u64CD\\u4F5C\\u3002\"), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u4E3B\\u8981\\u89E3\\u51B3\\u7684\\u4E00\\u4E2A\\u95EE\\u9898\\u5C31\\u662F\\u4E0D\\u7528\\u533A\\u5206\\u5143\\u7D20\\u662F\\u54EA\\u79CD\\uFF0C\\u800C\\u6839\\u636E\\u8BBF\\u95EE\\u8005\\u7684\\u4E0D\\u540C\\u4FE1\\u606F\\u8FD4\\u56DE\\u76F8\\u5E94\\u7684\\u4FE1\\u606F\\u3002\"))), mdx(\"p\", null, \"\\u60F3\\u8981\\u4E86\\u89E3\\u66F4\\u591A\\uFF1F\\u81EA\\u5DF1\\u52A8\\u624B\\u5199\\u4E00\\u4E2ALISP\\u8F6CC\\u8BED\\u8A00\\u98CE\\u683C\\u7684Compiler\\uFF1A\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/starkwang/the-super-tiny-compiler-cn/blob/master/super-tiny-compiler-chinese.js\"\n  }, \"super tiny compiler\")));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"date":"2024-03-06 19:59:03","title":"Babel工作流程","slug":"/blog/babel-workflow"}}},"pageContext":{"slug":"/blog/babel-workflow","next":"/blog/babel-packages","previous":"/blog/babel-plugin"}},"staticQueryHashes":[]}